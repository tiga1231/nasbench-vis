<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<title>My first three.js app</title>
<style>
  body { margin: 0; }
  canvas { width: 100%; height: 100% }
</style>
</head>


<body>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="js/three.js"></script>
<script src="js/GLTFLoader.js"></script>
<script src="js/OrbitControls.js"></script>

<script>


let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera( 75, 
    window.innerWidth/window.innerHeight, 
    0.1, 1000);
camera.position.set(0,0,5);
camera.lookAt(0,0,0);

let renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

var orbit = new THREE.OrbitControls( camera, renderer.domElement );
// orbit.enableZoom = false;

//=============================

let vertexShader = `
varying vec3 v_color;
attribute vec3 color;
void main() {
    v_color = color;
    gl_PointSize = 2.0;
    vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewPosition; 
}
`;
let fragmentShader = `
varying vec3 v_color;
void main() {
    gl_FragColor = vec4(v_color, 1.0);
}
`;

let objectGroup = new THREE.Group();
d3.json('embedding-10k.json').then(data=>{
    window.data = data;
    let cmap = d3.interpolateViridis;
    let colors = data.accuracy.map(a=>{
        let c = d3.color(cmap(a));
        return [c.r/255, c.g/255, c.b/255];
    });
    console.log(colors);
    let geometry = new THREE.BufferGeometry();
    let material = new THREE.ShaderMaterial({
        vertexShader,
        fragmentShader,
    });
    geometry.addAttribute( 'position', 
        new THREE.Float32BufferAttribute( 
            data.embedding.reduce((a,b)=>a.concat(b), []), 3 
    ));

    geometry.addAttribute( 'color', 
        new THREE.Float32BufferAttribute( 
            colors.reduce((a,b)=>a.concat(b), []), 3 
    ));

    

    let pointCloud = new THREE.Points(geometry, material);
    objectGroup.add(pointCloud);

})
scene.add(objectGroup);



//=============================

let light0 = new THREE.AmbientLight( 0xffffff, 0.5, 0 );
scene.add( light0 );

let light1 = new THREE.DirectionalLight( 0xffffff, 0.4);
light1.position.set( -50, 50, 80 );
scene.add( light1 );

//=============================

function animate(){
    requestAnimationFrame(animate);

    // objectGroup.rotation.y += 0.004;
    // objectGroup.rotation.y += 0.0015;

    renderer.render(scene, camera);
}
animate();


</script>
</body>
</html>